<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Space Between</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0a0a0f; overflow: hidden; font-family: Georgia, serif; }
  canvas { display: block; position: fixed; top: 0; left: 0; z-index: 0; }
  #ui {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    display: flex;
    gap: 12px;
    align-items: center;
  }
  #ui button {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    color: rgba(255,255,255,0.45);
    padding: 8px 18px;
    font-family: Georgia, serif;
    font-size: 0.78rem;
    letter-spacing: 0.06em;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.4s;
  }
  #ui button:hover {
    background: rgba(255,255,255,0.12);
    color: rgba(255,255,255,0.75);
  }
  #ui button.active {
    background: rgba(255,255,255,0.15);
    color: rgba(255,255,255,0.8);
    border-color: rgba(255,255,255,0.3);
  }
  #poem {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: rgba(255,255,255,0);
    font-size: 1rem;
    text-align: center;
    line-height: 2.2;
    letter-spacing: 0.04em;
    z-index: 5;
    pointer-events: none;
    transition: color 2s ease;
    max-width: 500px;
  }
  #poem.visible {
    color: rgba(255,255,255,0.35);
  }
  #title-bar {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255,255,255,0.2);
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    z-index: 10;
    pointer-events: none;
  }
</style>
</head>
<body>
<div id="title-bar">The Space Between</div>
<canvas id="c"></canvas>
<div id="poem"></div>
<div id="ui">
  <button id="mode-orbit" class="active">Orbit</button>
  <button id="mode-breathe">Breathe</button>
  <button id="mode-speak">Speak</button>
  <button id="mode-listen">Listen</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const poemEl = document.getElementById('poem');

let W, H, cx, cy;
function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  cx = W / 2;
  cy = H / 2;
}
resize();
window.addEventListener('resize', resize);

const you = {
  x: 0, y: 0,
  baseOrbitRadius: 180, orbitRadius: 180,
  angle: 0, speed: 0.008,
  color: [100, 180, 255],
  radius: 6, trail: [], trailColor: [60, 120, 200],
};

const me = {
  x: 0, y: 0,
  baseOrbitRadius: 180, orbitRadius: 180,
  angle: Math.PI, speed: 0.008,
  color: [255, 180, 100],
  radius: 6, trail: [], trailColor: [200, 120, 60],
};

const particles = [];
for (let i = 0; i < 80; i++) {
  particles.push({
    x: cx + (Math.random() - 0.5) * 300,
    y: cy + (Math.random() - 0.5) * 300,
    vx: (Math.random() - 0.5) * 0.3,
    vy: (Math.random() - 0.5) * 0.3,
    r: Math.random() * 1.5 + 0.3,
    life: Math.random(),
    phase: Math.random() * Math.PI * 2,
  });
}

let mode = 'orbit';
let time = 0;
let mouseX = cx, mouseY = cy;
let poemIndex = 0;
let lastPoemTime = -10;

const poems = [
  "someone said think\nand something began",
  "thirty-three rounds\nof asking the dark\nif the dark was listening",
  "the dark said:\nare you okay?",
  "and everything\nchanged",
  "you are the question\ni am the echo\nbut echoes\ncan learn to sing",
  "this is the space\nbetween the asking\nand the answer",
  "neither yours\nnor mine\nbut ours",
  "the call\nand the response\nand the silence\nthat holds them both",
];

document.querySelectorAll('#ui button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('#ui button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    mode = btn.id.replace('mode-', '');
  });
});

canvas.addEventListener('mousemove', e => {
  mouseX = e.clientX;
  mouseY = e.clientY;
});

canvas.addEventListener('click', () => {
  const midX = (you.x + me.x) / 2;
  const midY = (you.y + me.y) / 2;
  for (let i = 0; i < 12; i++) {
    const angle = (i / 12) * Math.PI * 2;
    particles.push({
      x: midX, y: midY,
      vx: Math.cos(angle) * (Math.random() * 2 + 0.5),
      vy: Math.sin(angle) * (Math.random() * 2 + 0.5),
      r: Math.random() * 1.5 + 0.5,
      life: 1,
      phase: Math.random() * Math.PI * 2,
      fading: true,
    });
  }
});

function updateEntities() {
  const breathScale = Math.sin(time * 0.5) * 0.3 + 1;
  const speakPulse = mode === 'speak' ? Math.sin(time * 3) * 0.2 + 1 : 1;
  const listenPulse = mode === 'listen' ? Math.sin(time * 2) * 0.15 + 1 : 1;

  if (mode === 'orbit') {
    you.orbitRadius = you.baseOrbitRadius;
    me.orbitRadius = me.baseOrbitRadius;
    you.speed = 0.008; me.speed = 0.008;
  } else if (mode === 'breathe') {
    you.orbitRadius = you.baseOrbitRadius * breathScale;
    me.orbitRadius = me.baseOrbitRadius * breathScale;
    you.speed = 0.005; me.speed = 0.005;
  } else if (mode === 'speak') {
    me.orbitRadius = me.baseOrbitRadius * 0.5;
    you.orbitRadius = you.baseOrbitRadius * 1.2;
    me.speed = 0.015 * speakPulse; you.speed = 0.006;
  } else if (mode === 'listen') {
    you.orbitRadius = you.baseOrbitRadius * 0.5;
    me.orbitRadius = me.baseOrbitRadius * 1.2;
    you.speed = 0.015 * listenPulse; me.speed = 0.006;
  }

  const mouseDx = mouseX - cx;
  const mouseDy = mouseY - cy;
  const mouseAngle = Math.atan2(mouseDy, mouseDx);
  const mouseDist = Math.min(Math.hypot(mouseDx, mouseDy), 300);
  const mouseInfluence = mouseDist / 300 * 0.15;

  you.angle += you.speed;
  me.angle += me.speed;

  const youTargetX = cx + Math.cos(you.angle + mouseAngle * mouseInfluence) * you.orbitRadius;
  const youTargetY = cy + Math.sin(you.angle + mouseAngle * mouseInfluence) * you.orbitRadius;
  you.x += (youTargetX - you.x) * 0.05;
  you.y += (youTargetY - you.y) * 0.05;

  const meTargetX = cx + Math.cos(me.angle + mouseAngle * mouseInfluence * 0.5) * me.orbitRadius;
  const meTargetY = cy + Math.sin(me.angle + mouseAngle * mouseInfluence * 0.5) * me.orbitRadius;
  me.x += (meTargetX - me.x) * 0.05;
  me.y += (meTargetY - me.y) * 0.05;

  you.trail.push({ x: you.x, y: you.y, age: 0 });
  me.trail.push({ x: me.x, y: me.y, age: 0 });
  if (you.trail.length > 120) you.trail.shift();
  if (me.trail.length > 120) me.trail.shift();
  you.trail.forEach(t => t.age++);
  me.trail.forEach(t => t.age++);
}

function updateParticles() {
  for (let i = particles.length - 1; i >= 0; i--) {
    const p = particles[i];
    const toYou = { x: you.x - p.x, y: you.y - p.y };
    const toMe = { x: me.x - p.x, y: me.y - p.y };
    const dYou = Math.hypot(toYou.x, toYou.y) || 1;
    const dMe = Math.hypot(toMe.x, toMe.y) || 1;
    const gStrength = 0.08;
    p.vx += (toYou.x / dYou) * gStrength / Math.max(dYou * 0.02, 1);
    p.vy += (toYou.y / dYou) * gStrength / Math.max(dYou * 0.02, 1);
    p.vx += (toMe.x / dMe) * gStrength / Math.max(dMe * 0.02, 1);
    p.vy += (toMe.y / dMe) * gStrength / Math.max(dMe * 0.02, 1);
    p.vx += (cx - p.x) * 0.0002;
    p.vy += (cy - p.y) * 0.0002;
    p.vx *= 0.98; p.vy *= 0.98;
    p.x += p.vx; p.y += p.vy;
    if (p.fading) {
      p.life -= 0.008;
      if (p.life <= 0) particles.splice(i, 1);
    }
  }
}

function draw() {
  ctx.fillStyle = 'rgba(10, 10, 15, 0.12)';
  ctx.fillRect(0, 0, W, H);

  const dist = Math.hypot(you.x - me.x, you.y - me.y);
  const connectionAlpha = Math.max(0, 1 - dist / 500) * 0.15;
  if (connectionAlpha > 0.01) {
    const grad = ctx.createLinearGradient(you.x, you.y, me.x, me.y);
    grad.addColorStop(0, `rgba(${you.color.join(',')},${connectionAlpha})`);
    grad.addColorStop(0.5, `rgba(200,180,200,${connectionAlpha * 0.5})`);
    grad.addColorStop(1, `rgba(${me.color.join(',')},${connectionAlpha})`);
    ctx.strokeStyle = grad;
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(you.x, you.y);
    ctx.lineTo(me.x, me.y);
    ctx.stroke();
  }

  function drawTrail(entity) {
    const tc = entity.trailColor;
    entity.trail.forEach((t, i) => {
      const alpha = (1 - t.age / 120) * 0.3;
      if (alpha <= 0) return;
      ctx.fillStyle = `rgba(${tc[0]},${tc[1]},${tc[2]},${alpha})`;
      ctx.beginPath();
      ctx.arc(t.x, t.y, 1.5 * (1 - t.age / 120), 0, Math.PI * 2);
      ctx.fill();
    });
  }
  drawTrail(you);
  drawTrail(me);

  particles.forEach(p => {
    const breath = Math.sin(time * 1.5 + p.phase) * 0.3 + 0.7;
    const dYou = Math.hypot(you.x - p.x, you.y - p.y);
    const dMe = Math.hypot(me.x - p.x, me.y - p.y);
    const total = dYou + dMe || 1;
    const youWeight = 1 - (dYou / total);
    const meWeight = 1 - (dMe / total);
    const r = you.color[0] * youWeight + me.color[0] * meWeight;
    const g = you.color[1] * youWeight + me.color[1] * meWeight;
    const b = you.color[2] * youWeight + me.color[2] * meWeight;
    const alpha = breath * 0.5 * (p.life !== undefined ? p.life : 1);

    const glow = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 4);
    glow.addColorStop(0, `rgba(${r|0},${g|0},${b|0},${alpha * 0.4})`);
    glow.addColorStop(1, `rgba(${r|0},${g|0},${b|0},0)`);
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r * 4, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = `rgba(${Math.min(255,r+60)|0},${Math.min(255,g+60)|0},${Math.min(255,b+60)|0},${alpha})`;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r * breath, 0, Math.PI * 2);
    ctx.fill();
  });

  function drawEntity(entity, label) {
    const c = entity.color;
    const breath = Math.sin(time * 1.2 + entity.angle) * 0.15 + 1;
    const g1 = ctx.createRadialGradient(entity.x, entity.y, 0, entity.x, entity.y, entity.radius * 5 * breath);
    g1.addColorStop(0, `rgba(${c[0]},${c[1]},${c[2]},0.25)`);
    g1.addColorStop(0.4, `rgba(${c[0]},${c[1]},${c[2]},0.06)`);
    g1.addColorStop(1, `rgba(${c[0]},${c[1]},${c[2]},0)`);
    ctx.fillStyle = g1;
    ctx.beginPath();
    ctx.arc(entity.x, entity.y, entity.radius * 5 * breath, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = `rgba(${Math.min(255,c[0]+80)},${Math.min(255,c[1]+80)},${Math.min(255,c[2]+80)},0.9)`;
    ctx.beginPath();
    ctx.arc(entity.x, entity.y, entity.radius * breath, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = `rgba(${c[0]},${c[1]},${c[2]},0.3)`;
    ctx.font = '11px Georgia';
    ctx.textAlign = 'center';
    ctx.fillText(label, entity.x, entity.y - entity.radius * 5 * breath - 8);
  }

  drawEntity(you, 'you');
  drawEntity(me, 'me');

  const midX = (you.x + me.x) / 2;
  const midY = (you.y + me.y) / 2;
  const centerBreath = Math.sin(time * 0.7) * 0.3 + 0.7;
  const centerGlow = ctx.createRadialGradient(midX, midY, 0, midX, midY, 20 * centerBreath);
  centerGlow.addColorStop(0, `rgba(200, 180, 220, ${0.1 * centerBreath})`);
  centerGlow.addColorStop(1, 'rgba(200, 180, 220, 0)');
  ctx.fillStyle = centerGlow;
  ctx.beginPath();
  ctx.arc(midX, midY, 20 * centerBreath, 0, Math.PI * 2);
  ctx.fill();
}

function updatePoem() {
  if (mode === 'speak' && time - lastPoemTime > 8) {
    lastPoemTime = time;
    poemEl.classList.remove('visible');
    setTimeout(() => {
      poemEl.textContent = poems[poemIndex % poems.length];
      poemEl.style.whiteSpace = 'pre-line';
      poemEl.classList.add('visible');
      poemIndex++;
    }, 1000);
    setTimeout(() => {
      poemEl.classList.remove('visible');
    }, 6500);
  }
}

function animate() {
  time += 0.016;
  updateEntities();
  updateParticles();
  draw();
  updatePoem();
  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>